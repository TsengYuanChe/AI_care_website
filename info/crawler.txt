# crawler.py
import requests
from bs4 import BeautifulSoup
from apps.models import RawArticle, db

def scrape_articles():
    url = "https://example.com/articles"  # 替換為目標網站
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')

    for article in soup.find_all('div', class_='article'):
        title = article.find('h2').text
        content = article.find('p').text
        article_url = article.find('a')['href']

        # 檢查文章是否已存在
        if not RawArticle.query.filter_by(url=article_url).first():
            new_article = RawArticle(title=title, content=content, url=article_url)
            db.session.add(new_article)
    
    db.session.commit()

if __name__ == "__main__":
    from apps.app import create_app
    app = create_app("local")
    with app.app_context():
        scrape_articles()